@model AgreementTermsModel
@{
    ViewData["Title"] = "Agreement Terms";
    ViewBag.ActiveSection = "AgreementTerms";
}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar Navigation -->
        <div class="col-md-3">
            <ul class="list-group">
                <li class="list-group-item @(ViewBag.ActiveSection == "Dashboard" ? "active" : "")">
                    <a href="/Dashboard/ViewPerformerDashboard?performerUsername=@ViewBag.PerformerUsername" style="@(ViewBag.ActiveSection == "Dashboard" ? "color: white;" : "")">
                        <i class="bi bi-speedometer2"></i> Dashboard Overview
                    </a>
                </li>
                <li class="list-group-item @(ViewBag.ActiveSection == "PerformerDetails" ? "active" : "")">
                    <a href="/Dashboard/PerformerDetails?performerUsername=@ViewBag.PerformerUsername" style="@(ViewBag.ActiveSection == "PerformerDetails" ? "color: white;" : "")">Performer Details</a>
                </li>
                <li class="list-group-item @(ViewBag.ActiveSection == "TestPractice" ? "active" : "")">
                    <a href="/Dashboard/TestPractice?performerUsername=@ViewBag.PerformerUsername" style="@(ViewBag.ActiveSection == "TestPractice" ? "color: white;" : "")">Test Practice</a>
                </li>
                <li class="list-group-item @(ViewBag.ActiveSection == "TestPractice2" ? "active" : "")">
                    <a href="/Dashboard/TestPractice2?performerUsername=@ViewBag.PerformerUsername" style="@(ViewBag.ActiveSection == "TestPractice2" ? "color: white;" : "")">Test Practice 2</a>
                </li>
                <li class="list-group-item @(ViewBag.ActiveSection == "Uploads" ? "active" : "")">
                    <a href="/Dashboard/Uploads?performerUsername=@ViewBag.PerformerUsername" style="@(ViewBag.ActiveSection == "Uploads" ? "color: white;" : "")">Uploads</a>
                </li>
                <li class="list-group-item @(ViewBag.ActiveSection == "StructuredConversation" ? "active" : "")">
                    <a href="/Dashboard/StructuredConversation?performerUsername=@ViewBag.PerformerUsername" style="@(ViewBag.ActiveSection == "StructuredConversation" ? "color: white;" : "")">Structured Conversation</a>
                </li>
                <li class="list-group-item @(ViewBag.ActiveSection == "AgreementTerms" ? "active" : "")">
                    <a href="/Dashboard/AgreementTerms?performerUsername=@ViewBag.PerformerUsername" style="@(ViewBag.ActiveSection == "AgreementTerms" ? "color: white;" : "")">Agreement Terms</a>
                </li>
                <li class="list-group-item @(ViewBag.ActiveSection == "WorkBasedAssessments" ? "active" : "")">
                    <a href="/Dashboard/WorkBasedAssessments?performerUsername=@ViewBag.PerformerUsername" style="@(ViewBag.ActiveSection == "WorkBasedAssessments" ? "color: white;" : "")">Work Based Assessments</a>
                </li>
                <li class="list-group-item @(ViewBag.ActiveSection == "CPD" ? "active" : "")">
                    <a href="/Dashboard/CPD?performerUsername=@ViewBag.PerformerUsername" style="@(ViewBag.ActiveSection == "CPD" ? "color: white;" : "")">CPD</a>
                </li>
                <li class="list-group-item @(ViewBag.ActiveSection == "MSF" ? "active" : "")">
                    <a href="@Url.Action("Index", "MSF")" style="@(ViewBag.ActiveSection == "MSF" ? "color: white;" : "")">
                        <i class="fas fa-comments"></i> MSF Assessment
                    </a>
                </li>
                <li class="list-group-item @(ViewBag.ActiveSection == "PSQ" ? "active" : "")">
                    <a href="/Dashboard/PSQ?performerUsername=@ViewBag.PerformerUsername" style="@(ViewBag.ActiveSection == "PSQ" ? "color: white;" : "")">PSQ</a>
                </li>
                <li class="list-group-item @(ViewBag.ActiveSection == "ClinicalNoteAudit" ? "active" : "")">
                    <a href="/Dashboard/ClinicalNoteAudit?performerUsername=@ViewBag.PerformerUsername" style="@(ViewBag.ActiveSection == "ClinicalNoteAudit" ? "color: white;" : "")">Clinical Note Audit</a>
                </li>
                <li class="list-group-item @(ViewBag.ActiveSection == "HelpGuidance" ? "active" : "")">
                    <a href="/Dashboard/HelpGuidance?performerUsername=@ViewBag.PerformerUsername" style="@(ViewBag.ActiveSection == "HelpGuidance" ? "color: white;" : "")">Help & Guidance</a>
                </li>
                <li class="list-group-item @(ViewBag.ActiveSection == "FinalSignOff" ? "active" : "")">
                    <a href="/Dashboard/FinalSignOff?performerUsername=@ViewBag.PerformerUsername" style="@(ViewBag.ActiveSection == "FinalSignOff" ? "color: white;" : "")">Final Sign off</a>
                </li>
                @if (ViewBag.IsOwnDashboard == true)
                {
                    <li class="list-group-item"><a href="/Account/Logout">Logout</a></li>
                }
                else
                {
                    <li class="list-group-item"><a href="/Dashboard/Index">Back to List</a></li>
                }
            </ul>
        </div>
        <!-- Main Content Area -->
        <div class="col-md-9">
            <div class="card">
                <div class="card-header">
                    <h3>Agreement Terms - @ViewBag.PerformerUsername</h3>
                </div>
                <div class="card-body">
                    <!-- Introductory Text -->
                    <div class="alert alert-info">
                        <p>This Agreement Terms has been drafted following an assessment by NHSE of the educational and clinical support needs of the above-named dental performer (the Performer). Its purpose is to set out the agreement between NHSE and the Performer that is intended to facilitate the Performer's safe induction to NHS primary care services, such that when all aspects of the agreement have been successfully completed, the Performer should feel confident and competent to deliver safe and effective care. During the Agreement Term period, a probationary flag will be shown against the Performer's name on the Performers List.</p>

                        <p>NHSE will review the Performer's progression through the Agreement at the agreed intervals and it will invite the Performer to submit evidence to prior to confirming whether agreed actions have been satisfactorily completed or whether further work is required.</p>
                    </div>
                    <!-- Success/Error Messages -->
                    @if (TempData["SuccessMessage"] != null)
                    {
                        <div class="alert alert-success">@TempData["SuccessMessage"]</div>
                    }
                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
                    }
                    @if (ViewBag.CanEditAdvisorFields == true)
                    {
                        <!-- ADVISOR VIEW - Can edit and release terms -->
                        <form asp-action="ReleaseAgreementTerms" method="post">
                            @Html.HiddenFor(m => m.Username)
                            @Html.HiddenFor(m => m.Id)
                            <h4 class="mt-4 mb-3">RESTRICTIONS</h4>
                            <p class="text-muted">Whilst this Agreement is in force, the services you provide will be restricted to:</p>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Restriction1, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Restriction1, "Practice Requirements & Supporting Dentist", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">You are to provide treatment only in a practice that has a minimum of 2 surgeries and where a supporting dentist will be present during your first 2 months. The supporting dentist must be a dentist with at least 3 years' experience in UK general dental practice, who will be available to provide immediate advice and support if required. You are to provide the name of the supporting dentist to NHS England at least 2 weeks before you commence providing NHS treatment.</div>
                                    </div>

                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Restriction2, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Restriction2, "No Out of Hours or Locum Work", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">You are not to provide any out of hours emergency care sessions or undertake any locum work during the period of this agreement without the prior written agreement of NHS England.</div>
                                    </div>

                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Restriction3, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Restriction3, "Report Complaints", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">You are to report any complaint that you receive during the period of this agreement to NHS England within 7 days of receipt.</div>
                                    </div>

                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Restriction4, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Restriction4, "12 Month Completion Timeframe", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">It is expected that you will complete the agreement within 12 months. If you are working part-time (less than 30 hours per week) then the expected timescale would be extended on a pro-rata basis up to a maximum of 24 months.</div>
                                    </div>

                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Restriction5, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Restriction5, "Probationary Flag Link", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">This agreement is linked to your probationary flag. If you move practice, the probationary flag and this agreement will remain in place. The probationary flag will only be removed when this agreement has been successfully completed.</div>
                                    </div>
                                </div>
                            </div>
                            <h4 class="mt-4 mb-3">SPECIFIC ACTIONS</h4>
                            <p class="text-muted">Required actions to be completed by the specified dates:</p>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Action1, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Action1, "NHS Courses", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">You are required to complete the following courses within <strong>3 months</strong>: NHS Rules & Regulations, Record Keeping, Prescribing, Communication Skills. Evidence of completion to be provided to NHS England.</div>
                                    </div>

                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Action2, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Action2, "NHS Competency References (After 6 months)", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">You are to provide two competency-based references from appropriate clinicians after <strong>6 months</strong> of NHS practice. One reference must be from your supporting dentist (if applicable) and one from another dentist or specialist with whom you have worked during your NHS practice.</div>
                                    </div>

                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Action3, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Action3, "GDC Core CPD Topics", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">You are to complete GDC core verifiable CPD in the following topics within <strong>6 months</strong>: Medical Emergencies, Disinfection and Decontamination, Radiography and Radiation Protection, Safeguarding Children and Vulnerable Adults. Evidence of completion to be provided to NHS England.</div>
                                    </div>

                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Action4, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Action4, "Up-to-date PDP", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">You are to submit an up-to-date Personal Development Plan (PDP) within <strong>1 month</strong> identifying your training and development needs and how these will be addressed. This should be reviewed and updated every 3 months during the agreement period.</div>
                                    </div>

                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Action5, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Action5, "Record Keeping Audit (After 3 months)", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">A record keeping audit will be carried out by NHS England after <strong>3 months</strong>. You must demonstrate compliance with NHS record keeping standards and any deficiencies identified must be addressed within the timescales specified by NHS England.</div>
                                    </div>

                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Action6, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Action6, "Clinical Audit with Reflection", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">You are to complete a clinical audit in your practice within <strong>6 months</strong>. This should be on a topic agreed with NHS England and should include a written reflection on the outcome and any changes made to your practice as a result.</div>
                                    </div>

                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Action7, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Action7, "Patient Satisfaction Survey (After 6 months)", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">After <strong>6 months</strong>, you are to undertake a patient satisfaction survey with a minimum of 20 responses and multi-source feedback from colleagues. You must provide a written reflection on the feedback received and any actions taken as a result.</div>
                                    </div>

                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Action8, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Action8, "IQD Programme Reflection", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">You are to provide a written reflection on your completion of the Induction and Development Programme (IQD), including how the learning has been applied to your NHS practice within <strong>3 months</strong> of programme completion.</div>
                                    </div>
                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Action9, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Action9, "3 DOPS on ID Block", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">You are to complete 3 Direct Observation of Procedural Skills (DOPS) assessments specifically for inferior dental (ID) block local anaesthetic administration with your supporting dentist within <strong>3 months</strong>. All assessments must demonstrate competency.</div>
                                    </div>

                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Action10, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Action10, "DOPS/CBDs - Radiography", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">You are to demonstrate competence in Radiography through Direct Observation of Procedural Skills (DOPS) or Case-Based Discussions (CBDs) with your supporting dentist within <strong>6 months</strong>. This must include both intraoral and extraoral radiographic techniques where applicable.</div>
                                    </div>

                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Action11, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Action11, "DOPS/CBDs - Periodontics", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">You are to demonstrate competence in Periodontics through Direct Observation of Procedural Skills (DOPS) or Case-Based Discussions (CBDs) with your supporting dentist within <strong>6 months</strong>. This must include periodontal assessment, non-surgical periodontal therapy, and patient periodontal health education.</div>
                                    </div>

                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Action12, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Action12, "DOPS/CBDs - Prosthetics", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">You are to demonstrate competence in Prosthetics through Direct Observation of Procedural Skills (DOPS) or Case-Based Discussions (CBDs) with your supporting dentist within <strong>6 months</strong>. This must include complete and partial denture provision, including assessment, treatment planning, and delivery.</div>
                                    </div>

                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Action13, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Action13, "DOPS/CBDs - Direct Restorations", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">You are to demonstrate competence in Direct Restorations through Direct Observation of Procedural Skills (DOPS) or Case-Based Discussions (CBDs) with your supporting dentist within <strong>6 months</strong>. This must include amalgam and composite restorations, including cavity preparation and restoration placement techniques.</div>
                                    </div>

                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Action14, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Action14, "DOPS/CBDs - Paedodontics", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">You are to demonstrate competence in Paedodontics through Direct Observation of Procedural Skills (DOPS) or Case-Based Discussions (CBDs) with your supporting dentist within <strong>6 months</strong>. This must include child behaviour management, preventive care, and treatment of dental caries in children.</div>
                                    </div>

                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Action15, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Action15, "DOPS/CBDs - Oral Surgery", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">You are to demonstrate competence in Oral Surgery through Direct Observation of Procedural Skills (DOPS) or Case-Based Discussions (CBDs) with your supporting dentist within <strong>6 months</strong>. This must include simple extractions, surgical extractions, and management of post-extraction complications.</div>
                                    </div>

                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Action16, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Action16, "DOPS/CBDs - Indirect Restorations", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">You are to demonstrate competence in Indirect Restorations through Direct Observation of Procedural Skills (DOPS) or Case-Based Discussions (CBDs) with your supporting dentist within <strong>6 months</strong>. This must include crown and bridge work, including tooth preparation, impression taking, and crown/bridge cementation.</div>
                                    </div>

                                    <div class="form-check mb-3">
                                        @Html.CheckBoxFor(m => m.Action17, new { @class = "form-check-input" })
                                        @Html.LabelFor(m => m.Action17, "DOPS/CBDs - Endodontics", new { @class = "form-check-label fw-bold" })
                                        <div class="form-text">You are to demonstrate competence in Endodontics through Direct Observation of Procedural Skills (DOPS) or Case-Based Discussions (CBDs) with your supporting dentist within <strong>6 months</strong>. This must include root canal treatment, including diagnosis, access cavity preparation, cleaning and shaping, and obturation techniques.</div>
                                    </div>
                                </div>
                            </div>
                            <!-- Custom Terms Section -->
                            <h4 class="mt-4 mb-3">Custom Agreement Terms</h4>
                            <div class="form-group mb-3">
                                @Html.LabelFor(m => m.CustomTerms, "Add Bespoke Terms (Optional)", new { @class = "form-label" })
                                @Html.TextAreaFor(m => m.CustomTerms, new { @class = "form-control", rows = "4", placeholder = "Enter any additional custom agreement terms specific to this performer..." })
                                <small class="form-text text-muted">These terms will be included with the selected standard terms above.</small>
                            </div>
                            <!-- Release Button -->
                            <div class="mt-4">
                                <button type="submit" class="btn btn-primary btn-lg">Release Agreement Terms</button>
                                @if (Model.IsAgreedByPerformer)
                                {
                                    <form asp-action="ResetPerformerAgreement" method="post" style="display: inline-block; margin-left: 10px;">
                                        <input type="hidden" name="performerUsername" value="@Model.Username" />
                                        <button type="submit" class="btn btn-warning" onclick="return confirm('Are you sure you want to reset the performer agreement? They will need to agree to the terms again.')">Reset Performer Agreement</button>
                                    </form>
                                }
                            </div>
                        </form>
                    }
                    else
                    {
                        <!-- PERFORMER/SUPERVISOR VIEW - Read-only with agreement option -->
                        @if (!Model.IsReleased)
                        {
                            <div class="alert alert-warning">
                                <strong>No Agreement Terms Released Yet</strong><br />
                                An advisor has not yet released agreement terms for this performer. Once terms are released, they will appear here.
                            </div>
                        }
                        else
                        {
                            <h4 class="mt-4 mb-3">Active Agreement Terms</h4>
                            <p class="text-muted">The following terms have been selected and released for this performer:</p>
                            @* Show only selected restrictions *@
                            @if (Model.Restriction1 || Model.Restriction2 || Model.Restriction3 || Model.Restriction4 || Model.Restriction5)
                            {
                                <h5 class="mt-3 mb-2">RESTRICTIONS</h5>
                                <div class="list-group mb-3">
                                    @if (Model.Restriction1) {
                                        <div class="list-group-item">
                                            <strong>✓ Practice Requirements & Supporting Dentist</strong><br />
                                            You are to provide treatment only in a practice that has a minimum of 2 surgeries and where a supporting dentist will be present during your first 2 months. The supporting dentist must be a dentist with at least 3 years' experience in UK general dental practice, who will be available to provide immediate advice and support if required. You are to provide the name of the supporting dentist to NHS England at least 2 weeks before you commence providing NHS treatment.
                                        </div>
                                    }
                                    @if (Model.Restriction2) {
                                        <div class="list-group-item">
                                            <strong>✓ No Out of Hours or Locum Work</strong><br />
                                            You are not to provide any out of hours emergency care sessions or undertake any locum work during the period of this agreement without the prior written agreement of NHS England.
                                        </div>
                                    }
                                    @if (Model.Restriction3) {
                                        <div class="list-group-item">
                                            <strong>✓ Report Complaints</strong><br />
                                            You are to report any complaint that you receive during the period of this agreement to NHS England within 7 days of receipt.
                                        </div>
                                    }
                                    @if (Model.Restriction4) {
                                        <div class="list-group-item">
                                            <strong>✓ 12 Month Completion Timeframe</strong><br />
                                            It is expected that you will complete the agreement within 12 months. If you are working part-time (less than 30 hours per week) then the expected timescale would be extended on a pro-rata basis up to a maximum of 24 months.
                                        </div>
                                    }
                                    @if (Model.Restriction5) {
                                        <div class="list-group-item">
                                            <strong>✓ Probationary Flag Link</strong><br />
                                            This agreement is linked to your probationary flag. If you move practice, the probationary flag and this agreement will remain in place. The probationary flag will only be removed when this agreement has been successfully completed.
                                        </div>
                                    }
                                </div>
                            }
                            @* Show only selected actions *@
                            @if (Model.Action1 || Model.Action2 || Model.Action3 || Model.Action4 || Model.Action5 ||
                                 Model.Action6 || Model.Action7 || Model.Action8 || Model.Action9 || Model.Action10 ||
                                 Model.Action11 || Model.Action12 || Model.Action13 || Model.Action14 || Model.Action15 ||
                                 Model.Action16 || Model.Action17)
                            {
                                <h5 class="mt-3 mb-2">SPECIFIC ACTIONS</h5>
                                <div class="list-group mb-3">
                                    @if (Model.Action1) {
                                        <div class="list-group-item">
                                            <strong>✓ NHS Courses (Within 3 months)</strong><br />
                                            You are required to complete the following courses within 3 months: NHS Rules & Regulations, Record Keeping, Prescribing, Communication Skills. Evidence of completion to be provided to NHS England.
                                        </div>
                                    }
                                    @if (Model.Action2) {
                                        <div class="list-group-item">
                                            <strong>✓ NHS Competency References (After 6 months)</strong><br />
                                            You are to provide two competency-based references from appropriate clinicians after 6 months of NHS practice. One reference must be from your supporting dentist (if applicable) and one from another dentist or specialist with whom you have worked during your NHS practice.
                                        </div>
                                    }
                                    @if (Model.Action3) {
                                        <div class="list-group-item">
                                            <strong>✓ GDC Core CPD Topics (Within 6 months)</strong><br />
                                            You are to complete GDC core verifiable CPD in the following topics within 6 months: Medical Emergencies, Disinfection and Decontamination, Radiography and Radiation Protection, Safeguarding Children and Vulnerable Adults. Evidence of completion to be provided to NHS England.
                                        </div>
                                    }
                                    @if (Model.Action4) {
                                        <div class="list-group-item">
                                            <strong>✓ Up-to-date PDP (Within 1 month)</strong><br />
                                            You are to submit an up-to-date Personal Development Plan (PDP) within 1 month identifying your training and development needs and how these will be addressed. This should be reviewed and updated every 3 months during the agreement period.
                                        </div>
                                    }
                                    @if (Model.Action5) {
                                        <div class="list-group-item">
                                            <strong>✓ Record Keeping Audit (After 3 months)</strong><br />
                                            A record keeping audit will be carried out by NHS England after 3 months. You must demonstrate compliance with NHS record keeping standards and any deficiencies identified must be addressed within the timescales specified by NHS England.
                                        </div>
                                    }
                                    @if (Model.Action6) {
                                        <div class="list-group-item">
                                            <strong>✓ Clinical Audit with Reflection (Within 6 months)</strong><br />
                                            You are to complete a clinical audit in your practice within 6 months. This should be on a topic agreed with NHS England and should include a written reflection on the outcome and any changes made to your practice as a result.
                                        </div>
                                    }
                                    @if (Model.Action7) {
                                        <div class="list-group-item">
                                            <strong>✓ Patient Satisfaction Survey (After 6 months)</strong><br />
                                            After 6 months, you are to undertake a patient satisfaction survey with a minimum of 20 responses and multi-source feedback from colleagues. You must provide a written reflection on the feedback received and any actions taken as a result.
                                        </div>
                                    }
                                    @if (Model.Action8) {
                                        <div class="list-group-item">
                                            <strong>✓ IQD Programme Reflection (Within 3 months of completion)</strong><br />
                                            You are to provide a written reflection on your completion of the Induction and Development Programme (IQD), including how the learning has been applied to your NHS practice within 3 months of programme completion.
                                        </div>
                                    }
                                    @if (Model.Action9) {
                                        <div class="list-group-item">
                                            <strong>✓ 3 DOPS on ID Block (Within 3 months)</strong><br />
                                            You are to complete 3 Direct Observation of Procedural Skills (DOPS) assessments specifically for inferior dental (ID) block local anaesthetic administration with your supporting dentist within 3 months. All assessments must demonstrate competency.
                                        </div>
                                    }
                                    @if (Model.Action10) {
                                        <div class="list-group-item">
                                            <strong>✓ DOPS/CBDs - Radiography (Within 6 months)</strong><br />
                                            You are to demonstrate competence in Radiography through Direct Observation of Procedural Skills (DOPS) or Case-Based Discussions (CBDs) with your supporting dentist within 6 months. This must include both intraoral and extraoral radiographic techniques where applicable.
                                        </div>
                                    }
                                    @if (Model.Action11) {
                                        <div class="list-group-item">
                                            <strong>✓ DOPS/CBDs - Periodontics (Within 6 months)</strong><br />
                                            You are to demonstrate competence in Periodontics through Direct Observation of Procedural Skills (DOPS) or Case-Based Discussions (CBDs) with your supporting dentist within 6 months. This must include periodontal assessment, non-surgical periodontal therapy, and patient periodontal health education.
                                        </div>
                                    }
                                    @if (Model.Action12) {
                                        <div class="list-group-item">
                                            <strong>✓ DOPS/CBDs - Prosthetics (Within 6 months)</strong><br />
                                            You are to demonstrate competence in Prosthetics through Direct Observation of Procedural Skills (DOPS) or Case-Based Discussions (CBDs) with your supporting dentist within 6 months. This must include complete and partial denture provision, including assessment, treatment planning, and delivery.
                                        </div>
                                    }
                                    @if (Model.Action13) {
                                        <div class="list-group-item">
                                            <strong>✓ DOPS/CBDs - Direct Restorations (Within 6 months)</strong><br />
                                            You are to demonstrate competence in Direct Restorations through Direct Observation of Procedural Skills (DOPS) or Case-Based Discussions (CBDs) with your supporting dentist within 6 months. This must include amalgam and composite restorations, including cavity preparation and restoration placement techniques.
                                        </div>
                                    }
                                    @if (Model.Action14) {
                                        <div class="list-group-item">
                                            <strong>✓ DOPS/CBDs - Paedodontics (Within 6 months)</strong><br />
                                            You are to demonstrate competence in Paedodontics through Direct Observation of Procedural Skills (DOPS) or Case-Based Discussions (CBDs) with your supporting dentist within 6 months. This must include child behaviour management, preventive care, and treatment of dental caries in children.
                                        </div>
                                    }
                                    @if (Model.Action15) {
                                        <div class="list-group-item">
                                            <strong>✓ DOPS/CBDs - Oral Surgery (Within 6 months)</strong><br />
                                            You are to demonstrate competence in Oral Surgery through Direct Observation of Procedural Skills (DOPS) or Case-Based Discussions (CBDs) with your supporting dentist within 6 months. This must include simple extractions, surgical extractions, and management of post-extraction complications.
                                        </div>
                                    }
                                    @if (Model.Action16) {
                                        <div class="list-group-item">
                                            <strong>✓ DOPS/CBDs - Indirect Restorations (Within 6 months)</strong><br />
                                            You are to demonstrate competence in Indirect Restorations through Direct Observation of Procedural Skills (DOPS) or Case-Based Discussions (CBDs) with your supporting dentist within 6 months. This must include crown and bridge work, including tooth preparation, impression taking, and crown/bridge cementation.
                                        </div>
                                    }
                                    @if (Model.Action17) {
                                        <div class="list-group-item">
                                            <strong>✓ DOPS/CBDs - Endodontics (Within 6 months)</strong><br />
                                            You are to demonstrate competence in Endodontics through Direct Observation of Procedural Skills (DOPS) or Case-Based Discussions (CBDs) with your supporting dentist within 6 months. This must include root canal treatment, including diagnosis, access cavity preparation, cleaning and shaping, and obturation techniques.
                                        </div>
                                    }
                                </div>
                            }
                            @* Show custom terms if any *@
                            @if (!string.IsNullOrEmpty(Model.CustomTerms))
                            {
                                <h5 class="mt-3 mb-2">CUSTOM TERMS</h5>
                                <div class="alert alert-secondary">
                                    @Html.Raw(Model.CustomTerms.Replace("\n", "<br />"))
                                </div>
                            }
                            <!-- Release Stamp -->
                            <div class="alert alert-success mt-4">
                                <strong>Released by:</strong> @Model.ReleasedBy<br />
                                <strong>Release Date:</strong> @Model.ReleasedDate?.ToString("dddd, MMMM dd, yyyy 'at' HH:mm")
                            </div>
                            <!-- Performer Agreement Section -->
                            @if (ViewBag.CurrentUser == Model.Username || ViewBag.CurrentRole == "admin" || ViewBag.CurrentRole == "superuser")
                            {
                                @if (!Model.IsAgreedByPerformer)
                                {
                                    <form asp-action="AgreeToTerms" method="post" class="mt-4">
                                        <input type="hidden" name="performerUsername" value="@Model.Username" />
                                        <button type="submit" class="btn btn-success btn-lg" onclick="return confirm('Are you sure you want to agree to these terms? This action confirms your acceptance of all the above agreement terms and restrictions.')">
                                            I Agree with These Terms
                                        </button>
                                    </form>
                                }
                                else
                                {
                                    <div class="alert alert-info mt-4">
                                        <strong>Agreed by:</strong> @Model.AgreedBy<br />
                                        <strong>Agreement Date:</strong> @Model.AgreedDate?.ToString("dddd, MMMM dd, yyyy 'at' HH:mm")<br />
                                        <em>You have successfully agreed to these terms.</em>
                                    </div>
                                }
                            }
                            else if (Model.IsAgreedByPerformer)
                            {
                                <div class="alert alert-info mt-4">
                                    <strong>Agreed by:</strong> @Model.AgreedBy<br />
                                    <strong>Agreement Date:</strong> @Model.AgreedDate?.ToString("dddd, MMMM dd, yyyy 'at' HH:mm")<br />
                                    <em>Performer has agreed to these terms.</em>
                                </div>
                            }
                        }
                    }
                </div>
            </div>
        </div>
    </div>
</div>
